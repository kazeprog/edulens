const fs = require('fs');
const path = require('path');

const jsonPath = path.join(process.cwd(), 'lib', 'data', 'mathtap', 'math-problems.json');

const grade = "数Ⅰ";
const unit1 = "放物線が$x$軸から切り取る線分の長さ";
const unit2 = "放物線と直線の共有点";

const data1_1 = [
    { q: "2次関数 $y=-x^2+4x+1$ のグラフが$x$軸から切り取る線分の長さを求めよ。", a: "$2\\sqrt{5}$" },
    { q: "2次関数 $y=x^2-5x+2$ のグラフが$x$軸から切り取る線分の長さを求めよ。", a: "$\\sqrt{17}$" },
    { q: "2次関数 $y=-x^2+2x+4$ のグラフが$x$軸から切り取る線分の長さを求めよ。", a: "$2\\sqrt{5}$" },
    { q: "2次関数 $y=x^2+x-1$ のグラフが$x$軸から切り取る線分の長さを求めよ。", a: "$\\sqrt{5}$" },
    { q: "2次関数 $y=-x^2+6x-2$ のグラフが$x$軸から切り取る線分の長さを求めよ。", a: "$2\\sqrt{7}$" },
    { q: "2次関数 $y=2x^2-4x-1$ のグラフが$x$軸から切り取る線分の長さを求めよ。", a: "$\\sqrt{6}$" },
    { q: "2次関数 $y=-x^2+3x+1$ のグラフが$x$軸から切り取る線分の長さを求めよ。", a: "$\\sqrt{13}$" },
    { q: "2次関数 $y=x^2-4x+2$ のグラフが$x$軸から切り取る線分の長さを求めよ。", a: "$2\\sqrt{2}$" },
    { q: "2次関数 $y=-2x^2+8x-3$ のグラフが$x$軸から切り取る線分の長さを求めよ。", a: "$\\sqrt{10}$" },
    { q: "2次関数 $y=x^2-6x+3$ のグラフが$x$軸から切り取る線分の長さを求めよ。", a: "$2\\sqrt{6}$" }
];

const data1_2 = [
    { q: "2次関数 $y=x^2-4ax+4a^2-5$ のグラフが$x$軸から切り取る線分の長さは、定数$a$の値に関係なく一定であることを示せ。", a: "$x^2-4ax+4a^2-5=0$ を解くと $x=2a\\pm\\sqrt{5}$。よって線分の長さは $(2a+\\sqrt{5})-(2a-\\sqrt{5})=2\\sqrt{5}$ となり、$a$によらず一定である。" },
    { q: "2次関数 $y=x^2+2ax+a^2-2$ のグラフが$x$軸から切り取る線分の長さは、定数$a$の値に関係なく一定であることを示せ。", a: "線分の長さは $2\\sqrt{2}$ となり、$a$によらず一定である。" },
    { q: "2次関数 $y=x^2-6ax+9a^2-7$ のグラフが$x$軸から切り取る線分の長さは、定数$a$の値に関係なく一定であることを示せ。", a: "線分の長さは $2\\sqrt{7}$ となり、$a$によらず一定である。" },
    { q: "2次関数 $y=x^2+10ax+25a^2-6$ のグラフが$x$軸から切り取る線分の長さは、定数$a$の値に関係なく一定であることを示せ。", a: "線分の長さは $2\\sqrt{6}$ となり、$a$によらず一定である。" },
    { q: "2次関数 $y=x^2-2ax+a^2-8$ のグラフが$x$軸から切り取る線分の長さは、定数$a$の値に関係なく一定であることを示せ。", a: "線分の長さは $4\\sqrt{2}$ となり、$a$によらず一定である。" },
    { q: "2次関数 $y=x^2+4ax+4a^2-10$ のグラフが$x$軸から切り取る線分の長さは、定数$a$の値に関係なく一定であることを示せ。", a: "線分の長さは $2\\sqrt{10}$ となり、$a$によらず一定である。" },
    { q: "2次関数 $y=x^2-8ax+16a^2-1$ のグラフが$x$軸から切り取る線分の長さは、定数$a$の値に関係なく一定であることを示せ。", a: "線分の長さは 2 となり、$a$によらず一定である。" },
    { q: "2次関数 $y=x^2+6ax+9a^2-12$ のグラフが$x$軸から切り取る線分の長さは、定数$a$の値に関係なく一定であることを示せ。", a: "線分の長さは $4\\sqrt{3}$ となり、$a$によらず一定である。" },
    { q: "2次関数 $y=x^2-12ax+36a^2-11$ のグラフが$x$軸から切り取る線分の長さは、定数$a$の値に関係なく一定であることを示せ。", a: "線分の長さは $2\\sqrt{11}$ となり、$a$によらず一定である。" },
    { q: "2次関数 $y=x^2+2ax+a^2-15$ のグラフが$x$軸から切り取る線分の長さは、定数$a$の値に関係なく一定であることを示せ。", a: "線分の長さは $2\\sqrt{15}$ となり、$a$によらず一定である。" }
];

const data2 = [
    {
        q: "放物線 $y=x^2-4x+1$ と直線 $y=2x-a$ がある。\n(1) $a=4$ のとき, 2つのグラフの共有点の座標を求めよ。\n(2) 2つのグラフの共有点がただ1つであるように定数$a$の値を定めよ。\n(3) 2つのグラフが共有点をもたないように定数$a$の値の範囲を定めよ。",
        a: "(1) (1,-2),(5,6)\n(2) $a=8$\n(3) $a>8$"
    },
    {
        q: "放物線 $y=x^2+2x+2$ と直線 $y=-2x-a$ がある。\n(1) $a=1$ のとき, 2つのグラフの共有点の座標を求めよ。\n(2) 2つのグラフの共有点がただ1つであるように定数$a$の値を定めよ。\n(3) 2つのグラフが共有点をもたないように定数$a$の値の範囲を定めよ。",
        a: "(1) (-1,1),(-3,5)\n(2) $a=2$\n(3) $a>2$"
    },
    {
        q: "放物線 $y=x^2-x-5$ と直線 $y=x-a$ がある。\n(1) $a=3$ のとき, 2つのグラフの共有点の座標を求めよ。\n(2) 2つのグラフの共有点がただ1つであるように定数$a$の値を定めよ。\n(3) 2つのグラフが共有点をもたないように定数$a$の値の範囲を定めよ。",
        a: "(1) (4,1),(-2,-5)\n(2) $a=6$\n(3) $a>6$"
    },
    {
        q: "放物線 $y=x^2+3x-1$ と直線 $y=-x-a$ がある。\n(1) $a=4$ のとき, 2つのグラフ의共有点の座標を求めよ。\n(2) 2つのグラフの共有点がただ1つであるように定数$a$の値を定めよ。\n(3) 2つのグラフが共有点をもたないように定数$a$の値の範囲を定めよ。",
        a: "(1) (-1,-3),(-3,-1)\n(2) $a=5$\n(3) $a>5$"
    },
    {
        q: "放物線 $y=x^2-2x+2$ と直線 $y=2x-a$ がある。\n(1) $a=-2$ のとき, 2つのグラフの共有点の座標を求めよ。\n(2) 2つのグラフの共有点がただ1つであるように定数$a$の値を定めよ。\n(3) 2つのグラフが共有点をもたないように定数$a$の値の範囲を定めよ。",
        a: "(1) (0,2),(4,6)\n(2) $a=2$\n(3) $a>2$"
    },
    {
        q: "放物線 $y=x^2+5x+3$ と直線 $y=x-a$ がある。\n(1) $a=0$ のとき, 2つのグラフの共有点の座標を求めよ。\n(2) 2つのグラフの共有点がただ1つであるように定数$a$の値を定めよ。\n(3) 2つのグラフが共有点をもたないように定数$a$の値の範囲を定めよ。",
        a: "(1) (-1,-1),(-3,-3)\n(2) $a=1$\n(3) $a>1$"
    },
    {
        q: "放物線 $y=x^2-3x-2$ と直線 $y=-x-a$ がある。\n(1) $a=-1$ のとき, 2つのグラフの共有点の座標を求めよ。\n(2) 2つのグラフの共有点がただ1つであるように定数$a$の値を定めよ。\n(3) 2つのグラフが共有点をもたないように定数$a$の値の範囲を定めよ。",
        a: "(1) (3,-4),(-1,0)\n(2) $a=3$\n(3) $a>3$"
    },
    {
        q: "放物線 $y=x^2+6x+2$ と直線 $y=2x-a$ がある。\n(1) $a=1$ のとき, 2つのグラフの共有点の座標を求めよ。\n(2) 2つのグラフの共有点がただ1つであるように定数$a$の値を定めよ。\n(3) 2つのグラフが共有点をもたないように定数$a$の値の範囲を定めよ。",
        a: "(1) (-1,-3),(-3,1)\n(2) $a=2$\n(3) $a>2$"
    },
    {
        q: "放物線 $y=x^2-x$ と直線 $y=3x-a$ がある。\n(1) $a=0$ のとき, 2つのグラフの共有点の座標を求めよ。\n(2) 2つのグラフの共有点がただ1つであるように定数$a$の値を定めよ。\n(3) 2つのグラフが共有点をもたないように定数$a$の値の範囲を定めよ。",
        a: "(1) (0,0),(4,12)\n(2) $a=4$\n(3) $a>4$"
    },
    {
        q: "放物線 $y=x^2+2x-1$ と直線 $y=-2x-a$ がある。\n(1) $a=4$ のとき, 2つのグラフの共有点の座標を求めよ。\n(2) 2つのグラフの共有点がただ1つであるように定数$a$の値を定めよ。\n(3) 2つのグラフが共有点をもたないように定数$a$の値の範囲を定めよ。",
        a: "(1) (-1,-3),(-3,2)\n(2) $a=5$\n(3) $a>5$"
    }
];

const existingJson = JSON.parse(fs.readFileSync(jsonPath, 'utf8'));
console.log(`Loaded existing JSON with ${existingJson.length} problems.`);
let lastProblemNumber = existingJson.length > 0 ? Math.max(...existingJson.map(p => p.problem_number)) : 0;

const newProblems = [];

function addProbs(data, unit) {
    for (const p of data) {
        const exists = existingJson.some(ex => ex.question === p.q && ex.unit === unit);
        if (!exists) {
            lastProblemNumber++;
            newProblems.push({
                grade: grade,
                unit: unit,
                problem_number: lastProblemNumber,
                question: p.q,
                answer: p.a
            });
        }
    }
}

addProbs(data1_1, unit1);
addProbs(data1_2, unit1);
addProbs(data2, unit2);

if (newProblems.length > 0) {
    const updatedJson = [...existingJson, ...newProblems];
    fs.writeFileSync(jsonPath, JSON.stringify(updatedJson, null, 4), 'utf8');
    console.log(`Added ${newProblems.length} problems to ${jsonPath}`);
} else {
    console.log("No new problems to add.");
}
