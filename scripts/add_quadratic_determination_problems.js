const fs = require('fs');
const path = require('path');

const jsonPath = path.join(process.cwd(), 'lib', 'data', 'mathtap', 'math-problems.json');

const unit = "2次関数の決定";

const data1_1 = [
    { q: "次の条件を満たす2次関数を求めよ。\nグラフの頂点が点(2, 1)で, 点(1, 3)を通る。", a: "$y=2(x-2)^2+1$" },
    { q: "次の条件を満たす2次関数を求めよ。\nグラフの頂点が点(-1, 4)で, 点(0, 2)を通る。", a: "$y=-2(x+1)^2+4$" },
    { q: "次の条件を満たす2次関数を求めよ。\nグラフの頂点が点(3, -2)で, 点(5, 6)を通る。", a: "$y=2(x-3)^2-2$" },
    { q: "次の条件を満たす2次関数を求めよ。\nグラフの頂点が点(-2, -5)で, 点(-1, -8)を通る。", a: "$y=-3(x+2)^2-5$" },
    { q: "次の条件を満たす2次関数を求めよ。\nグラフの頂点が点(0, 3)で, 点(2, -1)を通る。", a: "$y=-x^2+3$" },
    { q: "次の条件を満たす2次関数を求めよ。\nグラフの頂点が点(1, -1)で, 点(3, 7)を通る。", a: "$y=2(x-1)^2-1$" },
    { q: "次の条件を満たす2次関数を求めよ。\nグラフの頂点が点(-3, 2)で, 点(-1, 10)を通る。", a: "$y=2(x+3)^2+2$" },
    { q: "次の条件を満たす2次関数を求めよ。\nグラフの頂点が点(4, 0)で, 点(2, 8)を通る。", a: "$y=2(x-4)^2$" },
    { q: "次の条件を満たす2次関数を求めよ。\nグラフの頂点が点(-4, -3)で, 点(-2, -1)を通る。", a: "$y=\\frac{1}{2}(x+4)^2-3$" },
    { q: "次の条件を満たす2次関数を求めよ。\nグラフの頂点が点(2, 5)で, 点(4, 1)を通る。", a: "$y=-(x-2)^2+5$" }
];

const data1_2 = [
    { q: "次の条件を満たす2次関数を求めよ。\nグラフの軸が直線 x=2 で, 2点(1, 3), (4, 12)を通る。", a: "$y=3(x-2)^2$" },
    { q: "次の条件を満たす2次関数を求めよ。\nグラフの軸が直線 x=-1 で, 2点(0, 4), (1, 10)を通る。", a: "$y=2(x+1)^2+2$" },
    { q: "次の条件を満たす2次関数を求めよ。\nグラフの軸が直線 x=3 で, 2点(2, 0), (5, 9)を通る。", a: "$y=3(x-3)^2-3$" },
    { q: "次の条件を満たす2次関数を求めよ。\nグラフの軸が直線 x=-2 で, 2点(-1, 5), (0, 14)を通る。", a: "$y=3(x+2)^2+2$" },
    { q: "次の条件を満たす2次関数を求めよ。\nグラフの軸が直線 x=0 で, 2点(1, 2), (2, 8)を通る。", a: "$y=2x^2$" },
    { q: "次の条件を満たす2次関数を求めよ。\nグラフの軸が直線 x=4 で, 2点(3, -1), (2, 5)を通る。", a: "$y=2(x-4)^2-3$" },
    { q: "次の条件を満たす2次関数を求めよ。\nグラフの軸が直線 x=-3 で, 2点(-2, 1), (-1, -5)を通る。", a: "$y=-2(x+3)^2+3$" },
    { q: "次の条件を満たす2次関数を求めよ。\nグラフの軸が直線 x=1 で, 2点(2, 1), (3, -5)を通る。", a: "$y=-2(x-1)^2+3$" },
    { q: "次の条件を満たす2次関数を求めよ。\nグラフの軸が直線 x=-1 で, 2点(0, 1), (1, -5)を通る。", a: "$y=-2(x+1)^2+3$" },
    { q: "次の条件を満たす2次関数を求めよ。\nグラフの軸が直線 x=2 で, 2点(0, 7), (1, 1)を通る。", a: "$y=2(x-2)^2-1$" }
];

const data1_3 = [
    { q: "次の条件を満たす2次関数を求めよ。\nx=2 で最小値 -3 をとり, x=4 のとき y=5 である。", a: "$y=2(x-2)^2-3$" },
    { q: "次の条件を満たす2次関数を求めよ。\nx=-1 で最大値 4 をとり, x=1 のとき y=0 である。", a: "$y=-(x+1)^2+4$" },
    { q: "次の条件を満たす2次関数を求めよ。\nx=3 で最小値 1 をとり, x=0 のとき y=10 である。", a: "$y=(x-3)^2+1$" },
    { q: "次の条件を満たす2次関数を求めよ。\nx=-2 で最大値 -1 をとり, x=-3 のとき y=-3 である。", a: "$y=-2(x+2)^2-1$" },
    { q: "次の条件を満たす2次関数を求めよ。\nx=0 で最小値 -5 をとり, x=2 のとき y=3 である。", a: "$y=2x^2-5$" },
    { q: "次の条件を満たす2次関数を求めよ。\nx=1 で最大値 6 をとり, x=-1 のとき y=-2 である。", a: "$y=-2(x-1)^2+6$" },
    { q: "次の条件を満たす2次関数を求めよ。\nx=-4 で最小値 2 をとり, x=-2 のとき y=6 である。", a: "$y=(x+4)^2+2$" },
    { q: "次の条件を満たす2次関数を求めよ。\nx=5 で最大値 0 をとり, x=3 のとき y=-8 である。", a: "$y=-2(x-5)^2$" },
    { q: "次の条件を満たす2次関数を求めよ。\nx=-1 で最小値 -2 をとり, x=2 のとき y=16 である。", a: "$y=2(x+1)^2-2$" },
    { q: "次の条件を満たす2次関数を求めよ。\nx=2 で最大値 10 をとり, x=5 のとき y=-8 である。", a: "$y=-2(x-2)^2+10$" }
];

const data2_1 = [
    { q: "2次関数のグラフが次の3点を通るとき，その2次関数を求めよ。\n(1,2), (2,7), (3,14)", a: "$y=x^2+2x-1$" },
    { q: "2次関数のグラフが次の3点を通るとき，その2次関数を求めよ。\n(0,3), (1,4), (2,9)", a: "$y=2x^2-x+3$" },
    { q: "2次関数のグラフが次の3点を通るとき，その2次関数を求めよ。\n(-1,8), (1,2), (2,5)", a: "$y=2x^2-3x+3$" },
    { q: "2次関数のグラフが次の3点を通るとき，その2次関数を求めよ。\n(-2,4), (1,1), (3,9)", a: "$y=x^2$" },
    { q: "2次関数のグラフが次の3点を通るとき，その2次関数を求めよ。\n(1,0), (2,3), (3,8)", a: "$y=x^2-1$" },
    { q: "2次関数のグラフが次の3点を通るとき，その2次関数を求めよ。\n(1,6), (-1,4), (2,13)", a: "$y=x^2+x+4$" },
    { q: "2次関数のグラフが次の3点を通るとき，その2次関数を求めよ。\n(0,1), (1,3), (2,9)", a: "$y=2x^2+1$" },
    { q: "2次関数のグラフが次の3点を通るとき，その2次関数を求めよ。\n(-1,-1), (1,5), (2,14)", a: "$y=2x^2+3x$" },
    { q: "2次関数のグラフが次の3点を通るとき，その2次関数を求めよ。\n(1,-2), (2,-1), (3,4)", a: "$y=2x^2-5x+1$" },
    { q: "2次関数のグラフが次の3点を通るとき，その2次関数を求めよ。\n(-2,7), (0,-1), (1,1)", a: "$y=2x^2-1$" }
];

const data2_2 = [
    { q: "2次関数のグラフが次の3点を通るとき，その2次関数を求めよ。\n(-3,0), (1,0), (0,-3)", a: "$y=x^2+2x-3$" },
    { q: "2次関数のグラフが次の3点を通るとき，その2次関数を求めよ。\n(2,0), (4,0), (3,2)", a: "$y=-2x^2+12x-16$" },
    { q: "2次関数のグラフが次の3点を通るとき，その2次関数を求めよ。\n(-1,0), (5,0), (2,-9)", a: "$y=x^2-4x-5$" },
    { q: "2次関数のグラフが次の3点を通るとき，その2次関数を求めよ。\n(-4,0), (2,0), (-1,-9)", a: "$y=x^2+2x-8$" },
    { q: "2次関数のグラフが次の3点を通るとき，その2次関数を求めよ。\n(1,0), (3,0), (0,6)", a: "$y=2x^2-8x+6$" },
    { q: "2次関数のグラフが次の3点を通るとき，その2次関数を求めよ。\n(-2,0), (6,0), (1,-15)", a: "$y=x^2-4x-12$" },
    { q: "2次関数のグラフが次の3点を通るとき，その2次関数を求めよ。\n(0,0), (4,0), (2,4)", a: "$y=-x^2+4x$" },
    { q: "2次関数のグラフが次の3点を通るとき，その2次関数を求めよ。\n(-5,0), (-1,0), (-2,3)", a: "$y=x^2+6x+5$" },
    { q: "2次関数のグラフが次の3点を通るとき，その2次関数を求めよ。\n(3,0), (5,0), (4,-2)", a: "$y=2x^2-16x+30$" },
    { q: "2次関数のグラフが次の3点を通るとき，その2次関数を求めよ。\n(-2,0), (4,0), (0,-8)", a: "$y=x^2-2x-8$" }
];

const existingJson = JSON.parse(fs.readFileSync(jsonPath, 'utf8'));
console.log(`Loaded existing JSON with ${existingJson.length} problems.`);
let lastProblemNumber = existingJson.length > 0 ? Math.max(...existingJson.map(p => p.problem_number)) : 0;

const newProblems = [];
const grade = "数Ⅰ";

function addProbs(data) {
    for (const p of data) {
        const exists = existingJson.some(ex => ex.question === p.q && ex.unit === unit);
        if (!exists) {
            lastProblemNumber++;
            newProblems.push({
                grade: grade,
                unit: unit,
                problem_number: lastProblemNumber,
                question: p.q,
                answer: p.a
            });
        }
    }
}

addProbs(data1_1);
addProbs(data1_2);
addProbs(data1_3);
addProbs(data2_1);
addProbs(data2_2);

if (newProblems.length > 0) {
    const updatedJson = [...existingJson, ...newProblems];
    fs.writeFileSync(jsonPath, JSON.stringify(updatedJson, null, 4), 'utf8');
    console.log(`Added ${newProblems.length} problems to ${jsonPath}`);
} else {
    console.log("No new problems to add.");
}
