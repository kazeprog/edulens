const fs = require('fs');
const path = require('path');

const jsonPath = path.join(process.cwd(), 'lib', 'data', 'mathtap', 'math-problems.json');

const unit1 = "1次不等式の整数解";
const unit2 = "絶対値を含む方程式・不等式（基本）";

const data1_1 = [
    { q: "不等式 $4x+7(10-x)>5$ を満たす2桁の自然数 $x$ の個数を求めよ。", a: "12個" },
    { q: "不等式 $3x+5(8-x)>2$ を満たす2桁の自然数 $x$ の個数を求めよ。", a: "10個" },
    { q: "不等式 $2x+9(6-x)>-10$ を満たす2桁の自然数 $x$ の個数を求めよ。", a: "3個" },
    { q: "不等式 $5x+6(12-x)>4$ を満たす2桁の自然数 $x$ の個数を求めよ。", a: "9個" },
    { q: "不等式 $7x+3(20-x)>80$ を満たす2桁の自然数 $x$ の個数を求めよ。", a: "6個" },
    { q: "不等式 $8x+2(15-x)>100$ を満たす2桁の自然数 $x$ の個数を求めよ。", a: "2個" },
    { q: "不等式 $2x+10(14-x)>50$ を満たす2桁の自然数 $x$ の個数を求めよ。", a: "2個" },
    { q: "不等式 $4x+5(30-x)>110$ を満たす2桁の自然数 $x$ の個数を求めよ。", a: "30個" },
    { q: "不等式 $3x+6(25-x)>105$ を満たす2桁の自然数 $x$ の個数を求めよ。", a: "5個" },
    { q: "不等式 $9x+4(10-x)>120$ を満たす2桁の自然数 $x$ の個数を求めよ。", a: "7個" }
];

const data1_2 = [
    { q: "不等式 $3(x-1)<x+a$ を満たす $x$ のうちで, 最大の整数が $5$ であるとき, 定数 $a$ の値の範囲を求めよ。", a: "$7<a\\le9$" },
    { q: "不等式 $4(x-2)<2x+a$ を満たす $x$ のうちで, 最大の整数が $3$ であるとき, 定数 $a$ の値の範囲を求めよ。", a: "$-2<a\\le0$" },
    { q: "不等式 $5(x-3)<3x+a$ を満たす $x$ のうちで, 最大の整数が $8$ であるとき, 定数 $a$ の値の範囲を求めよ。", a: "$1<a\\le3$" },
    { q: "不等式 $2(x+4)<x+a$ を満たす $x$ のうちで, 最大の整数が $4$ であるとき, 定数 $a$ の値の範囲を求めよ。", a: "$8<a\\le9$" },
    { q: "不等式 $6(x-1)<4x+a$ を満たす $x$ のうちで, 最大の整数が $2$ であるとき, 定数 $a$ の値の範囲を求めよ。", a: "$-2<a\\le0$" },
    { q: "不等式 $3(x+2)<2(x+a)$ を満たす $x$ のうちで, 最大の整数が $10$ であるとき, 定数 $a$ の値の範囲を求めよ。", a: "$8<a\\le\\frac{17}{2}$" },
    { q: "不等式 $4(x-1)<3(x+a)$ を満たす $x$ のうちで, 最大の整数が $7$ であるとき, 定数 $a$ の値の範囲を求めよ。", a: "$\\frac{11}{3}<a\\le\\frac{14}{3}$" },
    { q: "不等式 $2(x-5)<x+a$ を満たす $x$ のうちで, 最大の整数が $12$ であるとき, 定数 $a$ の値の範囲を求めよ。", a: "$2<a\\le3$" },
    { q: "不等式 $5(x+1)<4x+a$ を満たす $x$ のうちで, 最大の整数が $0$ であるとき, 定数 $a$ の値の範囲を求めよ。", a: "$5<a\\le6$" },
    { q: "不等式 $3(x-4)<x+a$ を満たす $x$ のうちで, 最大の整数が $6$ であるとき, 定数 $a$ の値の範囲を求めよ。", a: "$0<a\\le2$" }
];

const data2_1 = [
    { q: "次の方程式を解け。\n$|5-x|=3$", a: "$x=2, 8$" },
    { q: "次の方程式を解け。\n$|1-x|=6$", a: "$x=-5, 7$" },
    { q: "次の方程式を解け。\n$|4-x|=2$", a: "$x=2, 6$" },
    { q: "次の方程式を解け。\n$|8-x|=5$", a: "$x=3, 13$" },
    { q: "次の方程式を解け。\n$|-x+3|=7$", a: "$x=-4, 10$" },
    { q: "次の方程式を解け。\n$|6-x|=1$", a: "$x=5, 7$" },
    { q: "次の方程式を解け。\n$|10-x|=4$", a: "$x=6, 14$" },
    { q: "次の方程式を解け。\n$|-x+2|=9$", a: "$x=-7, 11$" },
    { q: "次の方程式を解け。\n$|7-x|=10$", a: "$x=-3, 17$" },
    { q: "次の方程式を解け。\n$|3-x|=8$", a: "$x=-5, 11$" }
];

const data2_2 = [
    { q: "次の方程式を解け。\n$|3x+1|=10$", a: "$x=3, -\\frac{11}{3}$" },
    { q: "次の方程式を解け。\n$|2x-4|=6$", a: "$x=-1, 5$" },
    { q: "次の方程式を解け。\n$|4x+2|=10$", a: "$x=2, -3$" },
    { q: "次の方程式を解け。\n$|5x-5|=15$", a: "$x=4, -2$" },
    { q: "次の方程式を解け。\n$|3x-6|=9$", a: "$x=5, -1$" },
    { q: "次の方程式を解け。\n$|2x+8|=4$", a: "$x=-2, -6$" },
    { q: "次の方程式を解け。\n$|4x-4|=12$", a: "$x=4, -2$" },
    { q: "次の方程式を解け。\n$|5x+10|=20$", a: "$x=2, -6$" },
    { q: "次の方程式を解け。\n$|3x+4|=13$", a: "$x=3, -\\frac{17}{3}$" },
    { q: "次の方程式を解け。\n$|2x-3|=7$", a: "$x=5, -2$" }
];

const data2_3 = [
    { q: "次の不等式を解け。\n$|x-1|<3$", a: "$-2<x<4$" },
    { q: "次の不等式を解け。\n$|x+3|<5$", a: "$-8<x<2$" },
    { q: "次の不等式を解け。\n$|x-4|<2$", a: "$2<x<6$" },
    { q: "次の不等式を解け。\n$|x+2|<6$", a: "$-8<x<4$" },
    { q: "次の不等式を解け。\n$|x-5|<1$", a: "$4<x<6$" },
    { q: "次の不等式を解け。\n$|x+1|<4$", a: "$-5<x<3$" },
    { q: "次の不等式を解け。\n$|x-6|<7$", a: "$-1<x<13$" },
    { q: "次の不等式を解け。\n$|x+4|<8$", a: "$-12<x<4$" },
    { q: "次の不等式を解け。\n$|x-3|<10$", a: "$-7<x<13$" },
    { q: "次の不等式を解け。\n$|x+5|<2$", a: "$-7<x<-3$" }
];

const data2_4 = [
    { q: "次の不等式を解け。\n$|x-1|>3$", a: "$x<-2, 4<x$" },
    { q: "次の不等式を解け。\n$|x+3|>5$", a: "$x<-8, 2<x$" },
    { q: "次の不等式を解け。\n$|x-4|>2$", a: "$x<2, 6<x$" },
    { q: "次の不等式を解け。\n$|x+2|>6$", a: "$x<-8, 4<x$" },
    { q: "次の不等式を解け。\n$|x-5|>1$", a: "$x<4, 6<x$" },
    { q: "次の不等式を解け。\n$|x+1|>4$", a: "$x<-5, 3<x$" },
    { q: "次の不等式を解け。\n$|x-6|>7$", a: "$x<-1, 13<x$" },
    { q: "次の不等式を解け。\n$|x+4|>8$", a: "$x<-12, 4<x$" },
    { q: "次の不等式を解け。\n$|x-3|>10$", a: "$x<-7, 13<x$" },
    { q: "次の不等式を解け。\n$|x+5|>2$", a: "$x<-7, -3<x$" }
];

const existingJson = JSON.parse(fs.readFileSync(jsonPath, 'utf8'));
console.log(`Loaded existing JSON with ${existingJson.length} problems.`);
let lastProblemNumber = existingJson.length > 0 ? Math.max(...existingJson.map(p => p.problem_number)) : 0;

const newProblems = [];
const grade = "数Ⅰ";

function addProbs(data, unit) {
    for (const p of data) {
        const exists = existingJson.some(ex => ex.question === p.q && ex.unit === unit);
        if (!exists) {
            lastProblemNumber++;
            newProblems.push({
                grade: grade,
                unit: unit,
                problem_number: lastProblemNumber,
                question: p.q,
                answer: p.a
            });
        }
    }
}

addProbs(data1_1, unit1);
addProbs(data1_2, unit1);
addProbs(data2_1, unit2);
addProbs(data2_2, unit2);
addProbs(data2_3, unit2);
addProbs(data2_4, unit2);

if (newProblems.length > 0) {
    const updatedJson = [...existingJson, ...newProblems];
    fs.writeFileSync(jsonPath, JSON.stringify(updatedJson, null, 4), 'utf8');
    console.log(`Added ${newProblems.length} problems to ${jsonPath}`);
} else {
    console.log("No new problems to add.");
}
