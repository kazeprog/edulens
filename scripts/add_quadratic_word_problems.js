const fs = require('fs');
const path = require('path');

const jsonPath = path.join(process.cwd(), 'lib', 'data', 'mathtap', 'math-problems.json');

const grade = "数Ⅰ";
const unit1 = "2次関数の最大・最小（図形）";
const unit2 = "2次関数の最大・最小（文章題）";

const data1 = [
    { q: "$BC=12, CA=4$ である直角三角形 $ABC$ の斜辺 $AB$ 上に点 $D$ をとり, $D$ から辺 $BC, CA$ にそれぞれ垂線 $DE, DF$ を下ろす。$\\triangle ADF$ と $\\triangle DBE$ の面積の合計が最小となるとき、線分 $DE$ の長さとそのときの面積を求めよ。", a: "線分 $DE$ の長さ: 2, 面積: 12" },
    { q: "$BC=20, CA=10$ である直角三角形 $ABC$ の斜辺 $AB$ 上に点 $D$ をとり, $D$ から辺 $BC, CA$ にそれぞれ垂線 $DE, DF$ を下ろす。$\\triangle ADF$ と $\\triangle DBE$ の面積の合計が最小となるとき、線分 $DE$ の長さとそのときの面積を求めよ。", a: "線分 $DE$ の長さ: 5, 面積: 50" },
    { q: "$BC=16, CA=8$ である直角三角形 $ABC$ の斜辺 $AB$ 上に点 $D$ をとり, $D$ から辺 $BC, CA$ にそれぞれ垂線 $DE, DF$ を下ろす。$\\triangle ADF$ と $\\triangle DBE$ の面積の合計が最小となるとき、線分 $DE$ の長さとそのときの面積を求めよ。", a: "線分 $DE$ の長さ: 4, 面積: 32" },
    { q: "$BC=10, CA=6$ である直角三角形 $ABC$ の斜辺 $AB$ 上に点 $D$ をとり, $D$ から辺 $BC, CA$ にそれぞれ垂線 $DE, DF$ を下ろす。$\\triangle ADF$ と $\\triangle DBE$ の面積の合計が最小となるとき、線分 $DE$ の長さとそのときの面積を求めよ。", a: "線分 $DE$ の長さ: 3, 面積: 15" },
    { q: "$BC=24, CA=12$ である直角三角形 $ABC$ の斜辺 $AB$ 上に点 $D$ をとり, $D$ から辺 $BC, CA$ にそれぞれ垂線 $DE, DF$ を下ろす。$\\triangle ADF$ と $\\triangle DBE$ の面積の合計が最小となるとき、線分 $DE$ の長さとそのときの面積を求めよ。", a: "線分 $DE$ の長さ: 6, 面積: 72" },
    { q: "$BC=8, CA=4$ である直角三角形 $ABC$ の斜辺 $AB$ 上に点 $D$ をとり, $D$ から辺 $BC, CA$ にそれぞれ垂線 $DE, DF$ を下ろす。$\\triangle ADF$ と $\\triangle DBE$ の面積の合計が最小となるとき、線分 $DE$ の長さとそのときの面積を求めよ。", a: "線分 $DE$ の長さ: 2, 面積: 8" },
    { q: "$BC=14, CA=10$ である直角三角形 $ABC$ の斜辺 $AB$ 上に点 $D$ をとり, $D$ から辺 $BC, CA$ にそれぞれ垂線 $DE, DF$ を下ろす。$\\triangle ADF$ と $\\triangle DBE$ の面積の合計が最小となるとき、線分 $DE$ の長さとそのときの面積を求めよ。", a: "線分 $DE$ の長さ: 5, 面積: 35" },
    { q: "$BC=20, CA=4$ である直角三角形 $ABC$ の斜辺 $AB$ 上に点 $D$ をとり, $D$ から辺 $BC, CA$ にそれぞれ垂線 $DE, DF$ を下ろす。$\\triangle ADF$ と $\\triangle DBE$ の面積の合計が最小となるとき、線分 $DE$ の長さとそのときの面積を求めよ。", a: "線分 $DE$ の長さ: 2, 面積: 20" },
    { q: "$BC=18, CA=12$ である直角三角形 $ABC$ の斜辺 $AB$ 上に点 $D$ をとり, $D$ から辺 $BC, CA$ にそれぞれ垂線 $DE, DF$ を下ろす。$\\triangle ADF$ と $\\triangle DBE$ の面積の合計が最小となるとき、線分 $DE$ の長さとそのときの面積を求めよ。", a: "線分 $DE$ の長さ: 6, 面積: 54" },
    { q: "$BC=30, CA=6$ である直角三角形 $ABC$ の斜辺 $AB$ 上に点 $D$ をとり, $D$ から辺 $BC, CA$ にそれぞれ垂線 $DE, DF$ を下ろす。$\\triangle ADF$ と $\\triangle DBE$ の面積の合計が最小となるとき、線分 $DE$ の長さとそのときの面積を求めよ。", a: "線分 $DE$ の長さ: 3, 面積: 45" }
];

const data2_raw = [
    { q: "座標平面上で，点Pは原点Oを出発して，x軸上を毎秒1の速さで点(4,0)まで進み，点Qは点Pと同時に点(0,-4)を出発して，毎秒1の速さで原点Oまで進む。この間にP,Q間の距離が最小となるのは出発してから何秒後か。また，その最小の距離を求めよ。", a: "2秒後，最小の距離 $2\\sqrt{2}$" },
    { q: "座標平面上で，点Pは原点Oを出発して，x軸上を毎秒1の速さで点(8,0)まで進み，点Qは点Pと同時に点(0,-8)を出発して，毎秒1の速さで原点Oまで進む。この間にP,Q間の距離が最小となるのは出発してから何秒後か。また，その最小の距離を求めよ。", a: "4秒後，最小の距離 $4\\sqrt{2}$" },
    { q: "座標平面上で，点Pは原点Oを出発して，x軸上を毎秒1の速さで点(10,0)まで進み，点Qは点Pと同時に点(0,-10)を出発して，毎秒1の速さで原点Oまで進む。この間にP,Q間の距離が最小となるのは出発してから何秒後か。また，その最小の距離を求めよ。", a: "5秒後，最小の距離 $5\\sqrt{2}$" },
    { q: "座標平面上で，点Pは原点Oを出発して，x軸上を毎秒1の速さで点(12,0)まで進み，点Qは点Pと同時に点(0,-12)を出発して，毎秒1の速さで原点Oまで進む。この間にP,Q間の距離が最小となるのは出発してから何秒後か。また，その最小の距離を求めよ。", a: "6秒後，最小の距離 $6\\sqrt{2}$" },
    { q: "座標平面上で，点Pは原点Oを出発して，x軸上を毎秒2の速さで点(12,0)まで進み，点Qは点Pと同時に点(0,-12)を出発して，毎秒2の速さで原点Oまで進む。この間にP,Q間の距離が最小となるのは出発してから何秒後か。また，その最小の距離を求めよ。", a: "3秒後，最小の距離 $6\\sqrt{2}$" },
    { q: "座標平面上で，点Pは原点Oを出発して，x軸上を毎秒2の速さで点(8,0)まで進み，点Qは点Pと同時に点(0,-8)を出発して，毎秒2の速さで原点Oまで進む。この間にP,Q間の距離が最小となるのは出発してから何秒後か。また，その最小の距離を求めよ。", a: "2秒後，最小の距離 $4\\sqrt{2}$" },
    { q: "座標平面上で，点Pは原点Oを出発して，x軸上を毎秒1の速さで点(10,0)まで進み，点Qは点Pと同時に点(0,-10)を出発して，毎秒2の速さで原点Oまで進む。この間にP,Q間の距離が最小となるのは出発してから何秒後か。また，その最小の距離を求めよ。", a: "4秒後，最小の距離 $2\\sqrt{5}$" },
    { q: "座標平面上で，点Pは原点Oを出発して，x軸上を毎秒1の速さで点(5,0)まで進み，点Qは点Pと同時に点(0,-5)を出発して，毎秒2の速さで原点Oまで進む。この間にP,Q間の距離が最小となるのは出発してから何秒後か。また，その最小の距離を求めよ。", a: "2秒後，最小の距離 $\\sqrt{5}$" },
    { q: "座標平面上で，点Pは原点Oを出発して，x軸上を毎秒2の速さで点(10,0)まで進み，点Qは点Pと同時に点(0,-10)を出発して，毎秒1の速さで原点Oまで進む。この間にP,Q間の距離が最小となるのは出発してから何秒後か。また，その最小の距離を求めよ。", a: "2秒後，最小の距離 $4\\sqrt{5}$" },
    { q: "座標平面上で，点Pは原点Oを出発して，x軸上を毎秒2の速さで点(20,0)まで進み，点Qは点Pと同時に点(0,-20)を出発して，毎秒1の速さで原点Oまで進む。この間にP,Q間の距離が最小となるのは出発してから何秒後か。また，その最小の距離を求めよ。", a: "4秒後，最小の距離 $8\\sqrt{5}$" },
    { q: "座標平面上で，点Pは原点Oを出発して，x軸上を毎秒2の速さで点(14,0)まで進み，点Qは点Pと同時に点(0,-13)を出発して，毎秒3の速さで原点Oまで進む。この間にP,Q間の距離が最小となるのは出発してから何秒後か。また，その最小の距離を求めよ。", a: "3秒後，最小の距離 $2\\sqrt{13}$" },
    { q: "座標平面上で，点Pは原点Oを出発して，x軸上を毎秒1の速さで点(2,0)まで進み，点Qは点Pと同時に点(0,-2)を出発して，毎秒1の速さで原点Oまで進む。この間にP,Q間の距離が最小となるのは出発してから何秒後か。また，その最小の距離を求めよ。", a: "1秒後，最小の距離 $\\sqrt{2}$" },
    { q: "座標平面上で，点Pは原点Oを出発して，x軸上を毎秒1の速さで点(14,0)まで進み，点Qは点Pと同時に点(0,-14)を出発して，毎秒1の速さで原点Oまで進む。この間にP,Q間の距離が最小となるのは出発してから何秒後か。また，その最小の距離を求めよ。", a: "7秒後，最小の距離 $7\\sqrt{2}$" },
    { q: "座標平面上で，点Pは原点Oを出発して，x軸上を毎秒2の速さで点(20,0)まで進み，点Qは点Pと同時に点(0,-20)を出発して，毎秒2の速さで原点Oまで進む。この間にP,Q間の距離が最小となるのは出発してから何秒後か。また，その最小の距離を求めよ。", a: "5秒後，最小の距離 $10\\sqrt{2}$" },
    { q: "座標平面上で，点Pは原点Oを出発して，x軸上を毎秒3の速さで点(12,0)まで進み，点Qは点Pと同時に点(0,-12)を出発して，毎秒3の速さで原点Oまで進む。この間にP,Q間の距離が最小となるのは出発してから何秒後か。また，その最小の距離を求めよ。", a: "2秒後，最小の距離 $6\\sqrt{2}$" },
    { q: "座標平面上で，点Pは原点Oを出発して，x軸上を毎秒1の速さで点(10,0)まで進み，点Qは点Pと同時に点(0,-10)を出発して，毎秒3の速さで原点Oまで進む。この間にP,Q間の距離が最小となるのは出発してから何秒後か。また，その最小の距離を求めよ。", a: "3秒後，最小の距離 $\\sqrt{10}$" },
    { q: "座標平面上で，点Pは原点Oを出発して，x軸上を毎秒1の速さで点(20,0)まで進み，点Qは点Pと同時に点(0,-20)を出発して，毎秒3の速さで原点Oまで進む。この間にP,Q間の距離が最小となるのは出発してから何秒後か。また，その最小の距離を求めよ。", a: "6秒後，最小の距離 $2\\sqrt{10}$" },
    { q: "座標平面上で，点Pは原点Oを出発して，x軸上を毎秒1の速さで点(30,0)まで進み，点Qは点Pと同時に点(0,-30)を出発して，毎秒3の速さで原点Oまで進む。この間にP,Q間の距離が最小となるのは出発してから何秒後か。また，その最小の距離を求めよ。", a: "9秒後，最小の距離 $3\\sqrt{10}$" },
    { q: "座標平面上で，点Pは原点Oを出発して，x軸上を毎秒3の速さで点(30,0)まで進み，点Qは点Pと同時に点(0,-10)を出発して，毎秒1の速さで原点Oまで進む。この間にP,Q間の距離が最小となるのは出発してから何秒後か。また，その最小の距離を求めよ。", a: "1秒後，最小の距離 $3\\sqrt{10}$" },
    { q: "座標平面上で，点Pは原点Oを出発して，x軸上を毎秒3の速さで点(60,0)まで進み，点Qは点Pと同時に点(0,-20)を出発して，毎秒1の速さで原点Oまで進む。この間にP,Q間の距離が最小となるのは出発してから何秒後か。また，その最小の距離を求めよ。", a: "2秒後，最小の距離 $6\\sqrt{10}$" },
    { q: "座標平面上で，点Pは原点Oを出発して，x軸上を毎秒4の速さで点(40,0)まで進み，点Qは点Pと同時に点(0,-40)を出発して，毎秒4の速さで原点Oまで進む。この間にP,Q間の距離が最小となるのは出発してから何秒後か。また，その最小の距離を求めよ。", a: "5秒後，最小の距離 $20\\sqrt{2}$" },
    { q: "座標平面上で，点Pは原点Oを出発して，x軸上を毎秒1の速さで点(18,0)まで進み，点Qは点Pと同時に点(0,-18)を出発して，毎秒1の速さで原点Oまで進む。この間にP,Q間の距離が最小となるのは出発してから何秒後か。また，その最小の距離を求めよ。", a: "9秒後，最小の距離 $9\\sqrt{2}$" },
    { q: "座標平面上で，点Pは原点Oを出発して，x軸上を毎秒3の速さで点(26,0)まで進み，点Qは点Pと同時に点(0,-26)を出発して，毎秒2の速さで原点Oまで進む。この間にP,Q間の距離が最小となるのは出発してから何秒後か。また，その最小の距離を求めよ。", a: "4秒後，最小の距離 $6\\sqrt{13}$" },
    { q: "座標平面上で，点Pは原点Oを出発して，x軸上を毎秒1の速さで点(16,0)まで進み，点Qは点Pと同時に点(0,-16)を出発して，毎秒1の速さで原点Oまで進む。この間にP,Q間の距離が最小となるのは出発してから何秒後か。また，その最小の距離を求めよ。", a: "8秒後，最小の距離 $8\\sqrt{2}$" },
    { q: "座標平面上で，点Pは原点Oを出発して，x軸上を毎秒2の速さで点(6,0)まで進み，点Qは点Pと同時に点(0,-5)を出発して，毎秒1の速さで原点Oまで進む。この間にP,Q間の距離が最小となるのは出発してから何秒後か。また，その最小の距離を求めよ。", a: "1秒後，最小の距離 $2\\sqrt{5}$" },
    { q: "座標平面上で，点Pは原点Oを出発して，x軸上を毎秒3の速さで点(25,0)まで進み，点Qは点Pと同時に点(0,-25)を出発して，毎秒4の速さで原点Oまで進む。この間にP,Q間の距離が最小となるのは出発してから何秒後か。また，その最小の距離を求めよ。", a: "4秒後，最小の距離 15" },
    { q: "座標平面上で，点Pは原点Oを出発して，x軸上を毎秒1の速さで点(7,0)まで進み，点Qは点Pと同時に点(0,-7)を出発して，毎秒1の速さで原点Oまで進む。この間にP,Q間の距離が最小となるのは出発してから何秒後か。また，その最小の距離を求めよ。", a: "3.5秒後，最小の距離 $3.5\\sqrt{2}$" },
    { q: "座標平面上で，点Pは原点Oを出発して，x軸上を毎秒2の速さで点(10,0)まで進み，点Qは点Pと同時に点(0,-10)を出発して，毎秒2の速さで原点Oまで進む。この間にP,Q間の距離が最小となるのは出発してから何秒後か。また，その最小の距離を求めよ。", a: "2.5秒後，最小の距離 $5\\sqrt{2}$" },
    { q: "座標平面上で，点Pは原点Oを出発して，x軸上を毎秒1の速さで点(20,0)まで進み，点Qは点Pと同時に点(0,-20)を出発して，毎秒1の速さで原点Oまで進む。この間にP,Q間の距離が最小となるのは出発してから何秒後か。また，その最小の距離を求めよ。", a: "10秒後，最小の距離 $10\\sqrt{2}$" },
    { q: "座標平面上で，点Pは原点Oを出発して，x軸上を毎秒1の速さで点(1,0)まで進み，点Qは点Pと同時に点(0,-1)を出発して，毎秒1の速さで原点Oまで進む。この間にP,Q間の距離が最小となるのは出発してから何秒後か。また，その最小の距離を求めよ。", a: "0.5秒後，最小の距離 $\\frac{\\sqrt{2}}{2}$" }
];

const existingJson = JSON.parse(fs.readFileSync(jsonPath, 'utf8'));
console.log(`Loaded existing JSON with ${existingJson.length} problems.`);
let lastProblemNumber = existingJson.length > 0 ? Math.max(...existingJson.map(p => p.problem_number)) : 0;

const newProblems = [];

function addProbs(data, unit) {
    for (const p of data) {
        // Basic check: question and unit
        const exists = existingJson.some(ex => ex.question === p.q && ex.unit === unit);
        if (!exists) {
            lastProblemNumber++;
            newProblems.push({
                grade: grade,
                unit: unit,
                problem_number: lastProblemNumber,
                question: p.q,
                answer: p.a
            });
        }
    }
}

addProbs(data1, unit1);
// Convert data2 coords to LaTeX if necessary, but the user provided plain text mostly.
// I'll use it as is but wrap coord pairs in $ if they look like math? 
// Actually user used (4,0) etc. I'll just use the raw text.
addProbs(data2_raw, unit2);

if (newProblems.length > 0) {
    const updatedJson = [...existingJson, ...newProblems];
    fs.writeFileSync(jsonPath, JSON.stringify(updatedJson, null, 4), 'utf8');
    console.log(`Added ${newProblems.length} problems to ${jsonPath}`);
} else {
    console.log("No new problems to add.");
}
