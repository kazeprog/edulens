const fs = require('fs');
const path = require('path');

const jsonPath = path.join(process.cwd(), 'lib', 'data', 'mathtap', 'math-problems.json');

const unit1 = "2次関数の決定";
const unit2 = "2次関数の最大・最小（係数決定）";
const grade = "数Ⅰ";

const data1_1 = [
    { q: "次の条件を満たす放物線の方程式を求めよ。\n放物線 $y=x^2$ を平行移動した曲線で、2点(1,1), (2,4)を通る。", a: "$y=x^2+2x-2$" },
    { q: "次の条件を満たす放物線の方程式を求めよ。\n放物線 $y=3x^2$ を平行移動した曲線で、2点(0,1), (1,6)を通る。", a: "$y=3x^2+2x+1$" },
    { q: "次の条件を満たす放物線の方程式を求めよ。\n放物線 $y=-x^2$ を平行移動した曲線で、2点(1,0), (2,-3)を通る。", a: "$y=-x^2-x+2$" },
    { q: "次の条件を満たす放物線の方程式を求めよ。\n放物線 $y=2x^2$ を平行移動した曲線で、2点(-1,5), (0,2)を通る。", a: "$y=2x^2-x+2$" },
    { q: "次の条件を満たす放物線の方程式を求めよ。\n放物線 $y=-2x^2$ を平行移動した曲線で、2点(1,-1), (2,-6)を通る。", a: "$y=-2x^2+x$" },
    { q: "次の条件を満たす放物線の方程式を求めよ。\n放物線 $y=x^2$ を平行移動した曲線で、2点(1,3), (2,8)を通る。", a: "$y=x^2+2x$" },
    { q: "次の条件を満たす放物線の方程式を求めよ。\n放物線 $y=4x^2$ を平行移動した曲線で、2点(0,-2), (1,3)を通る。", a: "$y=4x^2+x-2$" },
    { q: "次の条件を満たす放物線の方程式を求めよ。\n放物線 $y=-3x^2$ を平行移動した曲線で、2点(-1,-5), (1,-1)を通る。", a: "$y=-3x^2+2x$" },
    { q: "次の条件を満たす放物線の方程式を求めよ。\n放物線 $y=\\frac{1}{2}x^2$ を平行移動した曲線で、2点(0,3), (2,9)を通る。", a: "$y=\\frac{1}{2}x^2+2x+3$" },
    { q: "次の条件を満たす放物線の方程式を求めよ。\n放物線 $y=-x^2$ を平行移動した曲線で、2点(1,2), (3,-2)を通る。", a: "$y=-x^2+2x+1$" }
];

const data1_2 = [
    { q: "次の条件を満たす放物線の方程式を求めよ。\n放物線 $y=x^2-4$ を平行移動した曲線で、原点を通り、頂点が直線 $y=x-2$ 上にある。", a: "$y=x^2-2x$ または $y=x^2+4x$" },
    { q: "次の条件を満たす放物線の方程式を求めよ。\n放物線 $y=2x^2+x$ を平行移動した曲線で、原点を通り、頂点が直線 $y=2x-4$ 上にある。", a: "$y=2x^2-4x$ または $y=2x^2+8x$" },
    { q: "次の条件を満たす放物線の方程式を求めよ。\n放物線 $y=-x^2+3$ を平行移動した曲線で、原点を通り、頂点が直線 $y=x+2$ 上にある。", a: "$y=-x^2+4x$ または $y=-x^2-2x$" },
    { q: "次の条件を満たす放物線の方程式を求めよ。\n放物線 $y=x^2+5$ を平行移動した曲線で、原点を通り、頂点が直線 $y=-4x-4$ 上にある。", a: "$y=x^2+4x$" },
    { q: "次の条件を満たす放物線の方程式を求めよ。\n放物線 $y=2x^2-2$ を平行移動した曲線で、原点を通り、頂点が直線 $y=-4x-2$ 上にある。", a: "$y=2x^2+4x$" },
    { q: "次の条件を満たす放物線の方程式を求めよ。\n放物線 $y=-x^2+x+1$ を平行移動した曲線で、原点を通り、頂点が直線 $y=x+2$ 上にある。", a: "$y=-x^2+4x$ または $y=-x^2-2x$" },
    { q: "次の条件を満たす放物線の方程式を求めよ。\n放物線 $y=x^2-x-1$ を平行移動した曲線で、原点を通り、頂点が直線 $y=x-2$ 上にある。", a: "$y=x^2-2x$ または $y=x^2+4x$" },
    { q: "次の条件を満たす放物線の方程式を求めよ。\n放物線 $y=-2x^2+4$ を平行移動した曲線で、原点を通り、頂点が直線 $y=x+3$ 上にある。", a: "$y=-2x^2-4x$ または $y=-2x^2+6x$" },
    { q: "次の条件を満たす放物線の方程式を求めよ。\n放物線 $y=3x^2-6x$ を平行移動した曲線で、原点を通り、頂点が直線 $y=5x+2$ 上にある。", a: "$y=3x^2+6x$ または $y=3x^2+4x$" },
    { q: "次の条件を満たす放物線の方程式を求めよ。\n放物線 $y=-x^2+2$ を平行移動した曲線で、原点を通り、頂点が直線 $y=-4x-4$ 上にある。", a: "$y=-x^2-4x$" }
];

const data2 = [
    {
        q: "関数 $f(x)=x^2-2ax+a^2+a-6$ ($0 \\le x \\le 1$) において\n(1) $f(x)$ の最小値 $m$ を定数 $a$ を用いて表せ。\n(2) $f(x)$ の最小値が 0 となるような定数 $a$ の値を求めよ。",
        a: "(1)\n$a<0$ のとき $m=a^2+a-6$\n$0 \\le a \\le 1$ のとき $m=a-6$\n$1<a$ のとき $m=a^2-a-5$\n(2) $a=-3, \\frac{1+\\sqrt{21}}{2}$"
    },
    {
        q: "関数 $f(x)=x^2-2ax+a^2-4a+3$ ($0 \\le x \\le 2$) において\n(1) $f(x)$ の最小値 $m$ を定数 $a$ を用いて表せ。\n(2) $f(x)$ の最小値が 0 となるような定数 $a$ の値を求めよ。",
        a: "(1)\n$a<0$ のとき $m=a^2-4a+3$\n$0 \\le a \\le 2$ のとき $m=-4a+3$\n$2<a$ のとき $m=a^2-8a+7$\n(2) $a=\\frac{3}{4}, 7$"
    },
    {
        q: "関数 $f(x)=x^2-2ax+a^2+5a-6$ ($0 \\le x \\le 1$) において\n(1) $f(x)$ の最小値 $m$ を定数 $a$ を用いて表せ。\n(2) $f(x)$ の最小値が 0 となるような定数 $a$ の値を求めよ。",
        a: "(1)\n$a<0$ のとき $m=a^2+5a-6$\n$0 \\le a \\le 1$ のとき $m=5a-6$\n$1<a$ のとき $m=a^2+3a-5$\n(2) $a=-6, \\frac{-3+\\sqrt{29}}{2}$"
    },
    {
        q: "関数 $f(x)=x^2-2ax+a^2-a-2$ ($0 \\le x \\le 1$) において\n(1) $f(x)$ の最小値 $m$ を定数 $a$ を用いて表せ。\n(2) $f(x)$ の最小値が 0 となるような定数 $a$ の値を求めよ。",
        a: "(1)\n$a<0$ のとき $m=a^2-a-2$\n$0 \\le a \\le 1$ のとき $m=-a-2$\n$1<a$ のとき $m=a^2-3a-1$\n(2) $a=-1, \\frac{3+\\sqrt{13}}{2}$"
    },
    {
        q: "関数 $f(x)=x^2-2ax+a^2+2a-8$ ($0 \\le x \\le 2$) において\n(1) $f(x)$ の最小値 $m$ を定数 $a$ を用いて表せ。\n(2) $f(x)$ の最小値が 0 となるような定数 $a$ の値を求めよ。",
        a: "(1)\n$a<0$ のとき $m=a^2+2a-8$\n$0 \\le a \\le 2$ のとき $m=2a-8$\n$2<a$ のとき $m=a^2-2a-4$\n(2) $a=-4, 1+\\sqrt{5}$"
    },
    {
        q: "関数 $f(x)=x^2-2ax+a^2-3a-4$ ($0 \\le x \\le 1$) において\n(1) $f(x)$ の最小値 $m$ を定数 $a$ を用いて表せ。\n(2) $f(x)$ の最小値が 0 となるような定数 $a$ の値を求めよ。",
        a: "(1)\n$a<0$ のとき $m=a^2-3a-4$\n$0 \\le a \\le 1$ のとき $m=-3a-4$\n$1<a$ のとき $m=a^2-5a-3$\n(2) $a=-1, \\frac{5+\\sqrt{37}}{2}$"
    },
    {
        q: "関数 $f(x)=x^2-2ax+a^2+4a-12$ ($0 \\le x \\le 1$) において\n(1) $f(x)$ の最小値 $m$ を定数 $a$ を用いて表せ。\n(2) $f(x)$ の最小値が 0 となるような定数 $a$ の値を求めよ。",
        a: "(1)\n$a<0$ のとき $m=a^2+4a-12$\n$0 \\le a \\le 1$ のとき $m=4a-12$\n$1<a$ のとき $m=a^2+2a-11$\n(2) $a=-6, -1+2\\sqrt{3}$"
    },
    {
        q: "関数 $f(x)=x^2-2ax+a^2-2a-3$ ($0 \\le x \\le 2$) において\n(1) $f(x)$ の最小値 $m$ を定数 $a$ を用いて表せ。\n(2) $f(x)$ の最小値が 0 となるような定数 $a$ の値を求めよ。",
        a: "(1)\n$a<0$ のとき $m=a^2-2a-3$\n$0 \\le a \\le 2$ のとき $m=-2a-3$\n$2<a$ のとき $m=a^2-6a+1$\n(2) $a=-1, 3+2\\sqrt{2}$"
    },
    {
        q: "関数 $f(x)=x^2-2ax+a^2+a-12$ ($0 \\le x \\le 1$) において\n(1) $f(x)$ の最小値 $m$ を定数 $a$ を用いて表せ。\n(2) $f(x)$ の最小値が 0 となるような定数 $a$ の値を求めよ。",
        a: "(1)\n$a<0$ のとき $m=a^2+a-12$\n$0 \\le a \\le 1$ のとき $m=a-12$\n$1<a$ のとき $m=a^2-a-11$\n(2) $a=-4, \\frac{1+3\\sqrt{5}}{2}$"
    },
    {
        q: "関数 $f(x)=x^2-2ax+a^2-5a+4$ ($0 \\le x \\le 2$) において\n(1) $f(x)$ の最小値 $m$ を定数 $a$ を用いて表せ。\n(2) $f(x)$ の最小値が 0 となるような定数 $a$ の値を求めよ。",
        a: "(1)\n$a<0$ のとき $m=a^2-5a+4$\n$0 \\le a \\le 2$ のとき $m=-5a+4$\n$2<a$ のとき $m=a^2-9a+8$\n(2) $a=\\frac{4}{5}, 8$"
    }
];

const existingJson = JSON.parse(fs.readFileSync(jsonPath, 'utf8'));
console.log(`Loaded existing JSON with ${existingJson.length} problems.`);
let lastProblemNumber = existingJson.length > 0 ? Math.max(...existingJson.map(p => p.problem_number)) : 0;

const newProblems = [];

function addProbs(data, unit) {
    for (const p of data) {
        const exists = existingJson.some(ex => ex.question === p.q && ex.unit === unit);
        if (!exists) {
            lastProblemNumber++;
            newProblems.push({
                grade: grade,
                unit: unit,
                problem_number: lastProblemNumber,
                question: p.q,
                answer: p.a
            });
        }
    }
}

addProbs(data1_1, unit1);
addProbs(data1_2, unit1);
addProbs(data2, unit2);

if (newProblems.length > 0) {
    const updatedJson = [...existingJson, ...newProblems];
    fs.writeFileSync(jsonPath, JSON.stringify(updatedJson, null, 4), 'utf8');
    console.log(`Added ${newProblems.length} problems to ${jsonPath}`);
} else {
    console.log("No new problems to add.");
}
